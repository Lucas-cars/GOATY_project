<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Principal</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../src/sistema.css">
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2 class="logo">
        <img src="../images/Cabra en el espacio estelar.jpg" alt="Logo GOATY" />
        GOATY
      </h2>
      <nav>
        <ul>
          <li onclick="mostrarSeccion('empleados')">Empleados</li>
          <li onclick="mostrarSeccion('informes')">Informes</li>
          <li onclick="mostrarSeccion('stock')">Stock</li>
        </ul>
      </nav>
    </aside>

    <!-- Contenido principal -->
    <main class="main-content">
      
      <!-- Sección Empleados -->
      <section id="empleados" class="seccion activa">
        <h1>Registrar Empleados</h1>

        <!-- Campos básicos -->
        <div class="form-group">
          <label>Nombre Completo</label>
          <input type="text" id="empleadoNombre" placeholder="Ej: Juan Pérez" />
        </div>
        <div class="form-group">
          <label>DNI</label>
          <input type="text" id="empleadoDNI" placeholder="Ej: 30123456" />
        </div>
        <div class="form-group">
          <label>Cargo</label>
          <input type="text" id="empleadoCargo" placeholder="Ej: Encargado, Vendedor..." />
        </div>

        <!-- Fecha de registro -->
        <div class="form-group">
          <label>Fecha de Registro</label>
          <input type="date" id="empleadoFechaRegistro" />
        </div>

        <!-- Selector de Asistencia -->
        <div class="form-group">
          <label>Asistencia</label>
          <select id="empleadoAsistencia" onchange="toggleCamposEmpleado()">
            <option value="Presente">Presente</option>
            <option value="Ausente">Ausente</option>
          </select>
        </div>

        <!-- Horarios de ingreso y salida -->
        <div class="form-group">
          <label>Hora de Ingreso</label>
          <input type="time" id="empleadoHoraIngreso" disabled />
        </div>
        <div class="form-group">
          <label>Hora de Salida</label>
          <input type="time" id="empleadoHoraSalida" disabled />
        </div>

        <button class="btn" onclick="agregarEmpleado()">Guardar</button>

        <h2>Lista de Empleados</h2>
        <table id="tablaEmpleados">
          <thead>
            <tr>
              <th>Nombre Completo</th>
              <th>DNI</th>
              <th>Cargo</th>
              <th>Fecha Registro</th>
              <th>Hora Ingreso</th>
              <th>Hora Salida</th>
              <th>Asistencia</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </section>

      <!-- Sección Informes -->
      <section id="informes" class="seccion">
        <h1>Generar Informes</h1>

        <!-- Selector de empleado con buscador -->
        <div class="form-group informe-empleado-container">
          <label for="selectorEmpleado">Seleccionar Empleado</label>
          <div class="selector-buscador">
            <select id="selectorEmpleado"></select>
            <input type="text" id="buscadorEmpleado" placeholder="Buscar..." oninput="filtrarEmpleados()"/>
          </div>
        </div>

        <div class="form-group">
          <label for="desde">Desde</label>
          <input type="date" id="desde" />
        </div>
        <div class="form-group">
          <label for="hasta">Hasta</label>
          <input type="date" id="hasta" />
        </div>

        <div class="form-group">
          <label for="observaciones">Observaciones (opcional)</label>
          <input type="text" id="observaciones" placeholder="Notas adicionales..." />
        </div>

        <button class="btn" onclick="generarInforme()">Generar Informe</button>

        <h2>Resumen del Informe</h2>
        <table id="tablaInforme">
          <thead>
            <tr>
              <th>Nombre Completo</th>
              <th>DNI</th>
              <th>Cargo</th>
              <th>Fecha Registro</th>
              <th>Hora Ingreso</th>
              <th>Hora Salida</th>
              <th>Asistencia</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </section>

      <!-- Sección Stock -->
      <section id="stock" class="seccion">
        <h1>Stock de Maderas</h1>
        <div class="form-group">
          <label>Tipo de Madera</label>
          <input type="text" placeholder="Ej: Pino, Roble..." id="tipoMadera" />
        </div>

        <div class="form-group">
          <label>Medidas</label>
          <input type="text" placeholder="Ej: 2x4, 2m..." id="medidas" />
        </div>

        <div class="form-group">
          <label>Cantidad</label>
          <input type="number" placeholder="Ej: 50" id="cantidad" />
        </div>

        <div class="form-group">
          <label>Precio Unitario</label>
          <input type="number" placeholder="Ej: 1500.00" id="precio" />
        </div>

        <button class="btn" onclick="agregarAlStock()">Guardar</button>

        <h2>Gráfico de Stock Actual</h2>
        <div class="resizable-container">
          <canvas id="graficoStock"></canvas>
        </div>
      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    /* ------------------ GENERAL ------------------ */
    function mostrarSeccion(id) {
      document.querySelectorAll('.seccion').forEach(sec => sec.classList.remove('activa'));
      document.getElementById(id).classList.add('activa');
      if(id === 'informes') actualizarSelectorEmpleados();
    }

    function toggleCamposEmpleado() {
      const asistencia = document.getElementById('empleadoAsistencia').value;
      ['empleadoHoraIngreso','empleadoHoraSalida'].forEach(id => {
        const campo = document.getElementById(id);
        if(asistencia==='Presente'){campo.disabled=false;}
        else{campo.disabled=true; campo.value='';}
      });
    }

    /* ------------------ EMPLEADOS ------------------ */
    let empleados = [];

    function agregarEmpleado() {
      const nombre = document.getElementById('empleadoNombre').value.trim();
      const dni = document.getElementById('empleadoDNI').value.trim();
      const cargo = document.getElementById('empleadoCargo').value.trim();
      const fechaRegistro = document.getElementById('empleadoFechaRegistro').value;
      const horaIngreso = document.getElementById('empleadoHoraIngreso').value;
      const horaSalida = document.getElementById('empleadoHoraSalida').value;
      const asistencia = document.getElementById('empleadoAsistencia').value;

      if(asistencia==='Presente' && (!nombre||!dni||!cargo||!fechaRegistro||!horaIngreso||!horaSalida)){
        alert('Por favor, completá todos los campos para empleados presentes.');
        return;
      }

      empleados.push({nombre,dni,cargo,fechaRegistro,horaIngreso,horaSalida,asistencia});
      actualizarTablaEmpleados();
      document.getElementById('empleadoNombre').value='';
      document.getElementById('empleadoDNI').value='';
      document.getElementById('empleadoCargo').value='';
      document.getElementById('empleadoFechaRegistro').value='';
      document.getElementById('empleadoAsistencia').value='Presente';
      toggleCamposEmpleado();
      actualizarSelectorEmpleados();
    }

    function actualizarTablaEmpleados() {
      const tbody = document.querySelector('#tablaEmpleados tbody');
      tbody.innerHTML='';
      empleados.forEach(emp=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${emp.nombre}</td><td>${emp.dni}</td><td>${emp.cargo}</td><td>${emp.fechaRegistro}</td><td>${emp.horaIngreso}</td><td>${emp.horaSalida}</td><td>${emp.asistencia}</td>`;
        tbody.appendChild(tr);
      });
    }

    /* ------------------ INFORMES ------------------ */
    function actualizarSelectorEmpleados() {
      const selector=document.getElementById('selectorEmpleado');
      selector.innerHTML='<option value="">Todos los empleados</option>';
      empleados.forEach((emp,idx)=>{
        const opt=document.createElement('option');
        opt.value=idx;
        opt.textContent=emp.nombre;
        selector.appendChild(opt);
      });
      document.getElementById('buscadorEmpleado').value='';
    }

    function filtrarEmpleados(){
      const texto = document.getElementById('buscadorEmpleado').value.toLowerCase();
      const selector=document.getElementById('selectorEmpleado');
      selector.innerHTML='<option value="">Todos los empleados</option>';
      empleados.forEach((emp,idx)=>{
        if(emp.nombre.toLowerCase().includes(texto)){
          const opt=document.createElement('option');
          opt.value=idx;
          opt.textContent=emp.nombre;
          selector.appendChild(opt);
        }
      });
    }

    function generarInforme(){
      const desde=document.getElementById('desde').value;
      const hasta=document.getElementById('hasta').value;
      const selectorEmpleado=document.getElementById('selectorEmpleado').value;

      if(!desde||!hasta){alert('Seleccioná fecha desde y hasta.'); return;}
      if(new Date(desde)>new Date(hasta)){alert('Fecha "Desde" mayor que "Hasta".'); return;}

      let empleadosFiltrados=empleados.filter(emp=>emp.fechaRegistro>=desde && emp.fechaRegistro<=hasta);
      if(selectorEmpleado!==''){empleadosFiltrados=[empleados[parseInt(selectorEmpleado)]];}

      const tbody=document.querySelector('#tablaInforme tbody');
      tbody.innerHTML='';
      empleadosFiltrados.forEach(emp=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${emp.nombre}</td><td>${emp.dni}</td><td>${emp.cargo}</td><td>${emp.fechaRegistro}</td><td>${emp.horaIngreso}</td><td>${emp.horaSalida}</td><td>${emp.asistencia}</td>`;
        tbody.appendChild(tr);
      });
    }

    /* ------------------ STOCK ------------------ */
    const ctxStock=document.getElementById('graficoStock').getContext('2d');
    let stockMaderas=[];

    const datosStock={labels:[],datasets:[{label:'Cantidad en Stock',data:[],backgroundColor:[],borderColor:'#bbb',borderWidth:1}]} ;
    const configStock={type:'bar',data:datosStock,options:{responsive:true,scales:{y:{beginAtZero:true,ticks:{color:'#ddd'}},x:{ticks:{color:'#ddd'}}},plugins:{legend:{labels:{color:'#ddd'}}}}};
    const graficoStock=new Chart(ctxStock,configStock);

    function agregarAlStock(){
      const tipo=document.getElementById('tipoMadera').value.trim();
      const cantidad=parseInt(document.getElementById('cantidad').value);
      if(!tipo||isNaN(cantidad)||cantidad<=0){alert("Ingresá tipo de madera válido y cantidad positiva");return;}
      const indiceExistente=stockMaderas.findIndex(m=>m.tipo.toLowerCase()===tipo.toLowerCase());
      if(indiceExistente!==-1){stockMaderas[indiceExistente].cantidad+=cantidad;}
      else{stockMaderas.push({tipo:tipo,cantidad:cantidad,color:'#'+Math.floor(Math.random()*16777215).toString(16)});}
      actualizarGraficoStock();
      document.getElementById('tipoMadera').value='';
      document.getElementById('medidas').value='';
      document.getElementById('cantidad').value='';
      document.getElementById('precio').value='';
    }

    function actualizarGraficoStock(){
      datosStock.labels=stockMaderas.map(m=>m.tipo);
      datosStock.datasets[0].data=stockMaderas.map(m=>m.cantidad);
      datosStock.datasets[0].backgroundColor=stockMaderas.map(m=>m.color);
      graficoStock.update();
    }
  </script>
</body>
</html>
